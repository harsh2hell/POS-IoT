{% extends "base.html" %}
{% block content %}

<div class="row g-4 align-items-start">
  <!-- LEFT HERO + ADD ITEM -->
  <div class="col-lg-7">
    <!-- Hero / summary -->
    <div class="hero-card mb-3 reveal card-hover" data-delay="0">
      <div class="d-flex flex-wrap justify-content-between align-items-center gap-13">
        <div>
          <div class="d-flex align-items-center gap-2 mb-1">
            <span class="badge bg-gradient text-black border-0 px-2 py-1">
              <i class="bi bi-lightning-charge me-1"></i> Live POS
            </span>
          </div>
          <h2 class="mb-1">Canteen Stock Updates</h2>
          <p class="muted mb-0">
            Get Updates on Canteen Items and Students Feedback here
          </p>
        </div>
        <div class="d-flex gap-53">
          <div>
            <div class="muted text-uppercase small mb-1">Food Items</div>
            <div class="stat">{{ items|length }}</div>
          </div>
          <div>
            <div class="muted text-uppercase small mb-1">Total Feedback</div>
            <div class="stat">{{ suggestions|length }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add item card -->
    <div class="card shadow-sm mb-3 reveal card-hover" data-delay="40">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h4 class="card-title mb-0">Add New Item to Menu</h4>
          <span class="item-badge">
            <i class="bi bi-plus-square-dotted me-1"></i> Quick add
          </span>
        </div>
        <form method="POST" action="{{ url_for('dashboard') }}">
          <div class="row g-3">
            <div class="col-md-5">
              <label class="form-label small text-muted">Item name</label>
              <input type="text" name="name" class="form-control" placeholder="Pizza" required>
            </div>
            <div class="col-md-3">
              <label class="form-label small text-muted">Price (₹)</label>
              <input type="number" step="0.01" name="price" class="form-control" placeholder="199" required>
            </div>
            <div class="col-md-4">
              <label class="form-label small text-muted">Category</label>
              <input type="text" name="category" class="form-control" placeholder="Snacks / Beverages / etc.">
            </div>
          </div>

          <div class="d-flex flex-wrap align-items-center justify-content-between mt-3 gap-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="available" id="available" checked>
              <label class="form-check-label" for="available">In Stock</label>
            </div>
            <button type="submit" class="btn btn-primary">
              <i class="bi bi-plus-lg me-1"></i> Add Item
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Catalog card -->
    <div class="card shadow-sm reveal card-hover" data-delay="80">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
            <h5 class="card-title mb-0">Menu</h5>
            <small class="muted">Total items available for order</small>
          </div>
          <span class="badge bg-secondary">
            {{ items|length }} items
          </span>
        </div>

        {% if items %}
        <div class="table-responsive">
          <table class="table align-middle mb-0">
            <thead class="table-light">
            <tr>
              <th>Code</th>
              <th>Name</th>
              <th>Category</th>
              <th class="text-end">Price (₹)</th>
              <th class="text-center">In Stock</th>
              <th class="text-end">Delete</th>
            </tr>
            </thead>
            <tbody>
            {# items = (id, name, price, category, available) #}
            {% for id, name, price, category, available in items %}
              <tr>
                <td>{{ id }}</td>
                <td>{{ name }}</td>
                <td>{{ category or '—' }}</td>
                <td class="text-end">{{ "%.2f"|format(price) }}</td>
                <td class="text-center">
                  {% if available %}
                    <span class="badge bg-success">Yes</span>
                  {% else %}
                    <span class="badge bg-danger">No</span>
                  {% endif %}
                </td>
                <td class="text-end">
                  <form method="POST"
                        action="{{ url_for('delete_item', item_id=id) }}"
                        onsubmit="return confirm('Delete {{ name }} from catalog?');">
                    <button class="btn btn-sm btn-outline-danger">
                      <i class="bi bi-trash"></i>
                    </button>
                  </form>
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
          <div class="alert alert-secondary mb-0">
            No items available! Add First food item from above.
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- RIGHT: How it works + feedback -->
  <div class="col-lg-5">
    <div class="card shadow-sm mb-3 reveal card-hover" data-delay="60">
      <div class="card-body">
        <h5 class="card-title mb-2">How DBS Canteen takes order?</h5>
        <ol class="small mb-0">
          <li>Add all items in your menu from this dashboard.</li>
          <li>Go to <strong>Order Now</strong> to take a new order.</li>
          <li>Select quantities for a customer and generate the QR code for payment.</li>
          <li>Customer scans QR → UPI app opens with the exact amount.</li>
          <li>After payment confirmation, mark the order as paid and redirects to invoice.</li>
        </ol>
      </div>
    </div>

    <div class="card shadow-sm reveal card-hover" data-delay="90">
      <div class="card-body">
        <h5 class="card-title d-flex justify-content-between align-items-center mb-3">
          <span>Students Feedback</span>
          <small class="text-muted">({{ suggestions|length }})</small>
        </h5>

        {% if suggestions %}
          <div class="row">
            {% for item, customer, rating, comments, date in suggestions %}
              <div class="col-12 mb-3">
                <div class="border rounded p-2 h-100">
                  <div class="d-flex justify-content-between gap-2">
                    <div>
                      <div class="fw-semibold">{{ item }}</div>
                      {% if comments %}
                        <div class="small text-muted">{{ comments }}</div>
                      {% endif %}
                    </div>
                    <div class="text-end small">
                      <div class="text-muted">
                        {{ customer or 'Anonymous' }}
                      </div>
                      {% if rating %}
                        <span class="badge bg-primary">⭐ {{ rating }}</span>
                      {% endif %}
                      <div class="text-muted">{{ date }}</div>
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="alert alert-secondary mb-0">
            No feedback yet. Share the <strong>QR Menu</strong> with students to collect feedback
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}
